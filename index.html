<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<title>Modding avec FiveM</title>

		<link rel="stylesheet" href="dist/reset.css">
		<link rel="stylesheet" href="dist/reveal.css">
		<link rel="stylesheet" href="dist/theme/black.css">

		<!-- Theme used for syntax highlighted code -->
		<link rel="stylesheet" href="plugin/highlight/monokai.css">
	</head>
	<body>
		<div class="reveal">
			<div class="slides">
				<section>
					<img src="./img/FiveM-Logo.png" alt="FiveM logo" style="height: 180px; margin: 0 auto 4rem auto; background: transparent;"/>
					<h3>Le modding avec FiveM</h3>
					<p>
						<small>Votre h√¥te : Vincent LAGNEAU</small>
					</p>
				</section>
				<section>
					<h2>√Ä propos</h2>
					<p>
						<ul>
							<li>D√©veloppeur Full-Stack</li>
							<li>Commenc√© par le C sur le site du Z√©ro</li>
							<li>Plein de langages (Java, PHP, Python, Elixir, ...)</li>
						</ul>
					</p>
				</section>
				<section>
					<h2>Modding</h2>
					<p>
						<ul>
							<li>Alt√©rer un ou des aspects d'un jeu vid√©o</li>
							<li>R√©alis√© par des gens externes √† l'√©quipe de dev</li>
							<li>Modifications visuelles, modifications / ajout features, refonte totale</li>
						</ul>
					</p>
					<p><small>Source : <a href="https://en.wikipedia.org/wiki/Video_game_modding">wikipedia</a></small></p>
				</section>
				<section>
					<h2>GTA V</h2>
					<p>
						<ul>
							<li>Sortie : 17 septembre 2013</li>
							<li>Jeu bac √† sable solo, puis multijoueurs</li>
							<li>170 millions de copies vendu √† septembre 2022</li>
							<li>2020 ann√©e avec le plus de ventes</li>
							<li>Derni√®re MAJ le 13/12/2022</li>
							<li>Au moins 2 grosses MAJ par ans</li>
						</ul>
					</p>
					<p><small>Sources : <a href="https://en.wikipedia.org/wiki/Grand_Theft_Auto_V">wikipedia GTA 5</a> | <a href="https://en.wikipedia.org/wiki/Grand_Theft_Auto_Online">wikipedia GTA Online</a> | <a href="https://www.gtabase.com/grand-theft-auto-v/title-updates/">gtabase.com</a></small></p>
				</section>
				<section>
					<h2>FiveM</h2>
					<p>
						<ul>
							<li>Mod de GTA V</li>
							<li>Objectif : jouer √† GTA Online sur des serveurs d√©di√©s</li>
							<li>Ex√©cution ind√©pendante de GTA V</li>
							<li>Un mod fait pour modder !</li>
						</ul>
					</p>
					<p><small>Source : <a href="https://fivem.net/">fivem.net</a></small></p>
				</section>
				<section>
					<h2>FiveM</h2>
					<p>
						<ul>
							<li>Fonctions internes du moteur via les <a href="https://docs.fivem.net/natives/">"Natives"</a></li>
							<li>Possible de coder en Lua / C# / JavaScript</li>
							<li>Interface en HTML / CSS</li>
							<li>Architecture client / serveur</li>
							<li>Programmation √©v√©nementielle</li>
						</ul>
						<p><small>Source : <a href="https://docs.fivem.net/docs/">FiveM Doc</a></small></p>
					</p>
				</section>
				<!-- <section>
					<h2>Serveur d√©di√©</h2>
					<p>
						<ul>
							<li>Jusqu'√† 2048 joueurs par serveur</li>
							<li>Possibilit√© d'importer ses propres v√©hicules, objets, v√™tements, ...</li>
							<li>Am√©lioration du netcode + synchronisation</li>
							<li>Co√ªt : 15 - 50‚Ç¨ HT / mois</li>
							<li>Possibilit√© de mon√©tiser son serveur : <a href="https://www.tebex.io/fivem">Tebex</a></li>
						</ul>
						<p><small>Source : <a href="https://fivem.net/server-hosting">FiveM Server hosting</a></small></p>
					</p>
				</section> -->
				<!-- <section>
					<h2>Lua Frameworks</h2>
					<p>
						<ul>
							<li><a href="https://documentation.esx-framework.org/">ESX</a> : LE framework FiveM</li>
							<li><a href="https://docs.qbcore.org/qbcore-documentation/">qbCore</a> : performances et modularit√©</li>
							<li><a href="https://vrp-framework.github.io/vRP/">vRP</a> : üíÄ</li>
						</ul>
					</p>
					<p><small>Source : <a href="https://docs.fivem.net/docs/server-manual/frameworks/">FiveM Frameworks</a></small></p>
				</section> -->
				<section>
					<h2>Ressource</h2>
					<p class="r-stack">
						<img class="fragment fade-out" data-fragment-index="0" src="./img/script.PNG" alt="Architecture basique de script"/>
						<img class="fragment current-visible" data-fragment-index="0" src="./img/script_html.PNG" alt="Architecture script avec HTML"/>
					</p>
				</section>
				<!-- <section>
					<h2>fxmanifest.lua</h2>
					<p>
						<ul>
							<li>N√©cessaire pour que FiveM d√©tecte la ressource</li>
							<li>Fichier Lua ex√©cut√© s√©par√©ment</li>
							<li>D√©cris les caract√©ristiques de la ressource:
								<ul>
									<li>version</li>
									<li>compatibilit√© et d√©pendances</li>
									<li>scripts √† ex√©cuter</li>
									<li>...</li>
								</ul>
							</li>
						</ul>
					</p>
					<p><small>Sources : <a href="https://docs.fivem.net/docs/scripting-reference/resource-manifest/resource-manifest/">Doc FiveM</a> | <a href="https://docs.fivem.net/docs/scripting-manual/introduction/creating-your-first-script/">Doc FiveM first script</a></small></p>
				</section> -->
				<section>
					<h2>fxmanifest.lua</h2>
					<pre class="lua">
						<code data-line-numbers>fx_version 'adamant'
game 'gta5'
author 'Braan'
version '1.0.0'

description 'Car Wash script o√π uniquement le pilote peut nettoyer son v√©hicule et o√π la taxe f√©d√©rale s applique'

server_scripts {
	'config.lua',
	'server/server.lua',
}

client_scripts {
	'@es_extended/locale.lua',
	'config.lua',
	'client/main.lua',
	'locales/fr.lua',
}

dependencies {
	'es_extended',
}
						</code>
					</pre>
					<p><small>Sources : <a href="https://docs.fivem.net/docs/scripting-reference/resource-manifest/resource-manifest/">Doc FiveM</a> | <a href="https://docs.fivem.net/docs/scripting-manual/introduction/creating-your-first-script/">Doc FiveM first script</a></small></p>
				</section>
				<section>
					<h2>C√¥t√© Client</h2>
					<p>
						<ul>
							<li>Scripts ex√©cut√©s sur le jeu du client</li>
							<li>Utilisation d'events clients / serveurs</li>
							<li>Affichages c√¥t√© client (markers, blips, interfaces, ...)</li>
							<li>Animations, gestions des int√©ractions, ...</li>
							<li>La majorit√© des fonctions FiveM sont c√¥t√© client</li>
						</ul>
					</p>
				</section>
				<section>
					<h2>Client</h2>
					<pre class="lua">
						<code data-line-numbers >AddEventHandler('lyr_carwash:hasEnteredMarker', function()
	insideMarker = true

	Citizen.CreateThread(function()
		while insideMarker do
			ESX.ShowHelpNotification(_U('carwash_help', Config.Price))

			if IsControlJustPressed(0, 38) then
				if IsPedInAnyVehicle(PlayerPedId(), false) then
					if GetPedInVehicleSeat(GetVehiclePedIsIn(PlayerPedId()), -1) == PlayerPedId() then
						TriggerEvent('lyr_carwash:cleanCar')
					else
						TriggerEvent('lyr_carwash:displayNotif', 'notTheDriver')
					end
				else
					TriggerEvent('lyr_carwash:displayNotif', 'noCarFound')
				end
			end
			Citizen.Wait(0)
		end
	end)
end)
						</code>
					</pre>
				</section>
				<section>
					<h2>C√¥t√© Serveur</h2>
					<p>
						<ul>
							<li>Connexion √† la base de donn√©es</li>
							<li>Capable de broadcast ou cibler un client</li>
							<li>Permet des interactions visibles par tous les joueurs (spawn v√©hicule, props, ...)</li>
							<li>Etat complet du serveur (joueurs, entit√©s, inventaires, ...)</li>
						</ul>
					</p>
				</section>
				<section>
					<h2>Serveur</h2>
					<pre class="lua">
						<code data-line-numbers>RegisterNetEvent('lyr_carwash:pay')
AddEventHandler('lyr_carwash:pay', function()
	local xPlayer = ESX.GetPlayerFromId(source)
	local price = ESX.Math.Round(Config.Price)

	if price > 0 then
		if xPlayer.getMoney() >= price then
			xPlayer.removeMoney(price)
			exports.lyr_federal:PayFederalTaxes(price)
			TriggerClientEvent('lyr_carwash:paymentsuccess', xPlayer.source, price)
		else
			TriggerClientEvent('lyr_carwash:displayNotif', xPlayer.source, 'paymentfailure')
		end
	end
end)
						</code>
					</pre>
				</section>
				<!-- <section>
					<h2>Onesync</h2>
					<p>
						<ul>
							<li>Entit√©s c√¥t√© serveur (peds, v√©hicules, objets, ...)</li>
							<li>Buckets pour s√©parer logiciellement des joueurs</li>
							<li>State bags : ajouter des cl√©s/valeurs custom √† vos entities</li>
						</ul>
					</p>
					<p><small>Sources : <a href="https://docs.fivem.net/docs/scripting-reference/onesync/">Doc Onesync</a> | <a href="https://docs.fivem.net/docs/scripting-manual/networking/state-bags/">Doc State bags</a></small></p>
				</section> -->
				<section>
					<h2>Bonnes pratiques</h2>
					<p>
						<ul>
							<li>Performance de la ressource c√¥t√© client via resmon</li>
							<li>Utilisation de Locale.lua pour les strings</li>
							<li>Fichier de config pour param√©trer la ressource</li>
						</ul>
					</p>
				</section>
				<section>
					<h2>Config.lua</h2>
					<pre class="lua">
						<code data-line-numbers>Config = {}
Config.Locale = 'fr'

Config.Sender = 'Drogue'
Config.Subject = 'Vente'

Config.AlertVehiculeTimeout = 30000

Config.Sale = {
    MaxSellingDistance = 1.0,

    WaitInBetweenStartSales = 30 * 1000, -- temps entre 2 start du script, en millisecondes

    -- Temps de recherche
    WaitBetweenCustomers = {
        Min = 20 * 1000,
        Max = 32 * 1000,
    },
    -- Temps d'attente du consomateur
    WaitCustomer = {
        Min = 50 * 1000,
        Max = 90 * 1000,
    },

    Zone = {
        MinimumNPCInZone = 25,
        Distance = {
            Min = 3,
            Max = 150,
        },
    },

    Animation = {
        Duration = 2000,
        AnimDict = 'mp_common',
        AnimationName = 'givetake2_a',
    },
}
						</code>
					</pre>
				</section>
				<section>
					<h2>Customisations</h2>
					<p>
						<ul>
							<li>Modifier la map (MLO)</li>
							<li>Utiliser les int√©rieurs de GTA Online (via IPL)</li>
							<li>V√©hicles custom / modifi√©s</li>
						</ul>
					</p>
				</section>
				<section>
					<h2>merci</h2>
				</section>
				<section>
					<iframe width="800" height="600" data-src="https://www.youtube.com/embed/MtKRytLh3s4" allowfullscreen></iframe>
				</section>
			</div>
		</div>

		<script src="dist/reveal.js"></script>
		<script src="plugin/notes/notes.js"></script>
		<script src="plugin/markdown/markdown.js"></script>
		<script src="plugin/highlight/highlight.js"></script>
		<script>
			// More info about initialization & config:
			// - https://revealjs.com/initialization/
			// - https://revealjs.com/config/
			Reveal.initialize({
				hash: true,
				slideNumber: true,

				// Learn about plugins: https://revealjs.com/plugins/
				plugins: [RevealMarkdown, RevealHighlight, RevealNotes]
			});
		</script>
	</body>
</html>
